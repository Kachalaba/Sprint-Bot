# Sprint-Bot для тренера з плавання

[![Lint](https://github.com/kachalaba/Sprint-Bot/actions/workflows/lint.yml/badge.svg)](https://github.com/kachalaba/Sprint-Bot/actions/workflows/lint.yml)
[![Tests](https://github.com/kachalaba/Sprint-Bot/actions/workflows/tests.yml/badge.svg)](https://github.com/kachalaba/Sprint-Bot/actions/workflows/tests.yml)
[![Docker](https://github.com/kachalaba/Sprint-Bot/actions/workflows/docker.yml/badge.svg)](https://github.com/kachalaba/Sprint-Bot/actions/workflows/docker.yml)

Як тренер, занурений у процес щоденних тренувань, я пройшов усі болючі етапи: нескінченні таблиці, забуті нагадування, розібрані результати учнів. Sprint-Bot створений саме для того, щоб повернути вам час у воді й забрати рутину з рук.

## Яку проблему вирішує Sprint-Bot
- **Зникає хаос у комунікації.** Всі повідомлення, інструкції й нагадування зібрані в Telegram-боті — жодних втрат у чатах.
- **Результати завжди під рукою.** Спортсмени фіксують час одразу після спринту, а я моментально бачу динаміку.
- **Фокус на тренуванні, а не на документах.** Автоматичні звіти, графіки та резервні копії дають спокій за дані команди.

## Чому варто використовувати
- **Більше довіри від спортсменів і батьків.** Прозорі графіки прогресу та повідомлення про особисті рекорди.
- **Гнучкі сценарії для клубів та збірних.** Від групових тренувань до індивідуальних планів — усе в одному інтерфейсі.
- **Професійний імідж.** Ви демонструєте сучасний підхід, з яким легко залучати нових спортсменів і партнерів.

## Як це працює
1. **Створюю спринт за секунди.** Команда `/newsprint` відкриває реєстрацію, обирає дистанцію й миттєво розсилає запрошення.
2. **Використовую шаблони для стилів.** Команда `/templates` підтягує улюблені розкладки ("4×25 батерфляй", "3×100 комплекс"). Спортсмен бачить підказки прямо в чаті.
3. **Аналізую прогрес автоматично.** `/progress` будує графік часу по кожному атлету: я розумію, де ми додаємо, а де буксуємо.
4. **Автоматизую нагадування.** Тихі години, попередження про старти, оновлення рекордів — усе налаштовується у `.env`.

![Приклад робочого екрану](screenshot.png)

## Технології
- **Python 3.11** — серце логіки бота.
- **aiogram 3** — сучасний фреймворк для Telegram Bot API.
- **PostgreSQL 15** — основне сховище для результатів та аналітики.
- **Google Sheets / SQLite** — підтримка існуючих таблиць і локальних кешів.
- **Docker & Docker Compose** — швидкий деплой без сюрпризів.
- **Sentry** — контроль за помилками ще до того, як їх помітить команда.
- **S3-сховище** — резервні копії, що не загубляться.
- **GitHub Actions** — CI/CD, який гарантує стабільні релізи.

## CI/CD та локальна розробка
- **pre-commit**: `pip install -r requirements.txt && pre-commit install` встановлює хуки (`black`, `isort`, `ruff`, trailing whitespace, end-of-file fixer).
- **Форматування**: `make format` застосує `isort` і `black` до всього репозиторію.
- **Лінт та типи**: `make lint` запускає `ruff` і `mypy --strict` для `sprint_bot/domain` та `services`.
- **Тести**: `make test` виконує `pytest` з покриттям і генерує `coverage.xml` для CI.
- **Контейнер**: `make build` збирає локальний образ, `make run` піднімає стек через `docker compose`.
- **GitHub Actions**: окремі пайплайни `lint.yml`, `tests.yml`, `docker.yml` забезпечують швидкий фідбек і збір образів із semver-тегами.

## З чого почати
1. **Клонуйте репозиторій** або завантажте реліз у зручну теку.
2. **Запустіть інсталяцію:**
   ```bash
   ./install.sh
   ```
   Скрипт перевіряє Docker, створює `.env`, просить токен бота та ID адміністраторів, збирає контейнер і піднімає Sprint-Bot.
3. **Скопіюйте конфіг:** перед `docker compose up` зробіть `cp .env.example .env` і заповніть параметри.
4. **Запускайте бота** й пишіть `/start` у Telegram — команда готова працювати.

## Міграції та імпорт даних
- **Створіть схему:** `make migrate` (використовує Alembic та `DB_URL`).
- **Імпортуйте дані з Google Sheets:** `make import_sheets` (потрібні `SPREADSHEET_KEY` і `creds.json`).
- **Docker Compose:** Postgres підіймається разом із ботом (`postgres:15`), дані зберігаються в volume `sprint-bot-pgdata`.

> **Порада від тренера.** Тримайте окремий `.env` для тренувального та бойового середовищ — так простіше перевіряти нові сценарії.

## Практичні сценарії
- **Групові тренування.** Один спринт на групу, спільні нагадування й миттєвий збір результатів.
- **Індивідуальні плани.** Персональні шаблони, приватні коментарі та корекція цілей на льоту.
- **Внутрішні ліги та челленджі.** Щотижневі спринти з автоматичним рейтингом та оголошенням переможців.
- **Підготовка до сезону.** Експорт CSV допомагає швидко оцінити прогрес по стилях і дистанціях.

## Часті запитання
**Docker не стартує.** Переконайтесь, що порт 8443 вільний, а команда `docker compose up -d --build` завершується без помилок. Логи — `docker compose logs -f sprint-bot`.

**Де взяти токен?** Напишіть @BotFather, створіть бота й перенесіть токен у `BOT_TOKEN`.

**Як імпортувати список спортсменів?** Використовуйте CSV із каталогу `examples/`. Відправляйте файл через `/import_athletes` — бот підкаже, якщо чогось бракує.

**Чи потрібні Google Sheets?** Ні, але для синхронізації з таблицею клубу додайте `creds.json` і заповніть `SPREADSHEET_KEY`.

## Що далі
- **Логування з ротацією.** Виносимо конфіг у `utils/logger.py`, щоб логи були під контролем.
- **Ліниве підключення Google Sheets.** Вмикаємо залежності тільки тоді, коли вони справді потрібні.
- **Стійкі підписки на сповіщення.** Зберігаємо їх у SQLite, аби після рестарту нічого не зникало.
- **Інтеграційні тести для S3-бекапів.** Гарантуємо, що кожен backup можна відновити.
- **Єдина конфігурація.** Створюємо модуль `config.py` для централізованих налаштувань.

Sprint-Bot — це моя особиста гарантія, що кожна секунда у воді працює на результат. Підключайтесь і перетворюйте команди на чемпіонів.
