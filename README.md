# Sprint-Bot

Sprint-Bot ‚Äî Telegram-–±–æ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ **Python** –∏ **aiogram 3**, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ ¬´—Å–ø—Ä–∏–Ω—Ç—ã¬ª. –ë–æ—Ç –ø–æ–¥–æ–π–¥–µ—Ç —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞–º –∏ —Ç—Ä–µ–Ω–µ—Ä–∞–º, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç—è—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Å–æ–≤–º–µ—Å—Ç–Ω—ã–µ —á–µ–ª–ª–µ–Ω–¥–∂–∏ –∏ —Å–ª–µ–¥–∏—Ç—å –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–ø—Ä–∏–Ω—Ç–æ–≤ –∏ –≤—ã–±–æ—Ä –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏;
- –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–º —Å–ø—Ä–∏–Ω—Ç–∞–º;
- —Ñ–∏–∫—Å–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ —Ä–∞—Å—á–µ—Ç –ª–∏—á–Ω—ã—Ö —Ä–µ–∫–æ—Ä–¥–æ–≤;
- –ø—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–ø—ã—Ç–æ–∫;
- –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏.

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- Python 3;
- –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ aiogram 3 –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram API;
- –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏).

## –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞

–ö–æ–º–∞–Ω–¥–∞ `/progress` –¥–æ–∑–≤–æ–ª—è—î –æ–±—Ä–∞—Ç–∏ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞ —Ç–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ –∑–º—ñ–Ω–∏ —á–∞—Å—É –ø–æ
—Ä—ñ–∑–Ω–∏—Ö –¥–∏—Å—Ç–∞–Ω—Ü—ñ—è—Ö. –ü—ñ—Å–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –±–æ—Ç –Ω–∞–¥—Å–∏–ª–∞—î –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑ –ª—ñ–Ω—ñ—è–º–∏ –¥–ª—è –∫–æ–∂–Ω–æ—ó
–¥–∏—Å—Ç–∞–Ω—Ü—ñ—ó —Ç–∞ –∫–æ—Ä–æ—Ç–∫—É —Ç–∞–±–ª–∏—Ü—é –¥–∏–Ω–∞–º—ñ–∫–∏ (—Å—Ç–∞—Ä—Ç, –ø–æ—Ç–æ—á–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —ñ —Ä—ñ–∑–Ω–∏—Ü—è).

–ù–∏–∂—á–µ –Ω–∞–≤–µ–¥–µ–Ω–æ —Å–ø—Ä–æ—â–µ–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ –∫–æ–¥—É –ø–æ–±—É–¥–æ–≤–∏ –≥—Ä–∞—Ñ—ñ–∫–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é
`matplotlib` —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –π–æ–≥–æ —É —á–∞—Ç Telegram:

```python
import io
import matplotlib

from aiogram.types import BufferedInputFile

matplotlib.use("Agg")
import matplotlib.pyplot as plt


async def send_progress_chart(message, dates, values):
    fig, ax = plt.subplots()
    ax.plot(dates, values, marker="o")
    ax.set_title("–ü—Ä–æ–≥—Ä–µ—Å —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞")
    ax.set_xlabel("–î–∞—Ç–∞")
    ax.set_ylabel("–ß–∞—Å, —Å")

    buffer = io.BytesIO()
    fig.savefig(buffer, format="png", dpi=150)
    plt.close(fig)
    buffer.seek(0)

    await message.answer_photo(
        BufferedInputFile(buffer.getvalue(), filename="progress.png"),
        caption="üìà –ü—Ä–æ–≥—Ä–µ—Å –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è",
    )
```

## –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

Sprint-Bot –Ω–∞–¥—Å–∏–ª–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –Ω–æ–≤—ñ —Å–ø—Ä–∏–Ω—Ç–∏ —Ç–∞ –ø–æ–≤—ñ–¥–æ–º–ª—è—î –ø—Ä–æ
–¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–æ–∂—É—Ç—å –∫–µ—Ä—É–≤–∞—Ç–∏ –ø—ñ–¥–ø–∏—Å–∫–æ—é –∫–æ–º–∞–Ω–¥–∞–º–∏
`/notify_on`, `/notify_off` —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ —Ä–æ–∑–∫–ª–∞–¥ `/notify_info`.

–ë–∞–∑–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ –ø–æ–±—É–¥–æ–≤–∞–Ω–∞ –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º—É —Å–µ—Ä–≤—ñ—Å—ñ `NotificationService`, —è–∫–∏–π
–∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è —Ä–∞–∑–æ–º —ñ–∑ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–º aiogram:

```python
notification_service = NotificationService(bot)

dp.startup.register(notification_service.startup)
dp.shutdown.register(notification_service.shutdown)

await dp.start_polling(bot, notifications=notification_service)
```

–°–µ—Ä–≤—ñ—Å –≤–º—ñ—î –ø–ª–∞–Ω—É–≤–∞—Ç–∏ —á–µ—Ä–≥–æ–≤–µ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è, —Ñ–æ—Ä–º—É–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç —Ä–æ–∑—Å–∏–ª–∫–∏ —Ç–∞
—Ä–æ–∑–ø–æ–≤—Å—é–¥–∂—É–≤–∞—Ç–∏ push-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ª–∏—à–µ —Å–µ—Ä–µ–¥ –ø—ñ–¥–ø–∏—Å–∞–Ω–∏—Ö —á–∞—Ç—ñ–≤:

```python
next_run = notification_service.next_sprint_run()
await notification_service.broadcast_text(
    f"‚è± –ù–∞—Å—Ç—É–ø–Ω–∏–π —Å–ø—Ä–∏–Ω—Ç: {next_run:%d.%m –æ %H:%M}"
)
```

–ü—ñ—Å–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –±–æ—Ç –æ–¥—Ä–∞–∑—É –ø–æ–≤—ñ–¥–æ–º–ª—è—î –∫–æ–º–∞–Ω–¥—É –ø—Ä–æ –∑–º—ñ–Ω–∏:

```python
await notification_service.notify_new_result(
    actor_id=coach.id,
    actor_name=coach.full_name,
    athlete_id=athlete_id,
    athlete_name=athlete_name,
    dist=dist,
    total=total,
    timestamp=timestamp,
    new_prs=new_prs,
)
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
   ```bash
   git clone <repository_url>
   cd Sprint-Bot
   ```
2. –°–æ–∑–¥–∞–π—Ç–µ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
   ```bash
   python -m venv venv
   source venv/bin/activate  # Windows: venv\Scripts\activate
   ```
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   pip install -r requirements.txt
   ```
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env.example` –≤ `.env` –∏ –∑–∞–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `BOT_TOKEN` —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–∞ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞.
5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç:
   ```bash
   python bot.py
   ```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- `bot.py` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞, —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å–æ —Å–ø—Ä–∏–Ω—Ç–∞–º–∏.
- `db.py` ‚Äî –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö SQLite (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü, –∑–∞–ø—Ä–æ—Å—ã).
- `keyboards.py` ‚Äî —Ñ–∞–π–ª —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä Telegram –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.
- `examples/` ‚Äî –ø—Ä–∏–º–µ—Ä—ã —Ñ–∞–π–ª—ñ–≤ –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É —Ç–∞ –ø–æ—è—Å–Ω–µ–Ω–Ω—è —Ñ–æ—Ä–º–∞—Ç—É.

## –Ü–º–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤

–î–ª—è –º–∞—Å–æ–≤–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ CSV-—Ñ–∞–π–ª —É —Ñ–æ—Ä–º–∞—Ç—ñ –∑ –∫–∞—Ç–∞–ª–æ–≥—É
`examples/`. –ö–æ–∂–µ–Ω —Ä—è–¥–æ–∫ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ `athlete_id` —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞, —è–∫–∏–π —É–∂–µ
–∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π —É –±–æ—Ç—ñ, —ñ (–∑–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ) –π–æ–≥–æ —ñ–º'—è –∑ –∞—Ä–∫—É—à–∞ `AthletesList`.

> ‚ùóÔ∏è –†—è–¥–∫–∏ –∑ –Ω–µ–≤—ñ–¥–æ–º–∏–º–∏ –∞–±–æ –Ω–µ–∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–º–∏ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞–º–∏ –±—É–¥—É—Ç—å –≤—ñ–¥—Ö–∏–ª–µ–Ω—ñ –ø—ñ–¥ —á–∞—Å
> —ñ–º–ø–æ—Ä—Ç—É. –ü–µ—Ä–µ–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤—Å—ñ —É—á–∞—Å–Ω–∏–∫–∏ –¥–æ–¥–∞–Ω—ñ –¥–æ —Ä–µ—î—Å—Ç—Ä—É.

